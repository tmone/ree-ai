# Repository Guidelines

## Project Structure & Module Organization
```
ree-ai/
├─ core/                 # Core service abstractions
├─ services/             # Individual Docker‑based services (registry, gateway, …)
├─ shared/               # Shared utilities, models and prompts
├─ frontend/             # Open‑WebUI frontend (React)
├─ tests/                # pytest suite, reports and coverage output
├─ docs/                 # Architecture docs, guides, reports
├─ data/                 # Raw site analysis JSON files
├─ scripts/              # Helper scripts used during development
├─ requirements.txt      # Production Python dependencies
└─ Makefile              # Primary dev / CI commands
```
Source code lives mainly under **core**, **services**, and **shared**.  Test files are in **tests/** and follow the `test_*.py` naming pattern.

## Build, Test & Development Commands
The repository uses the bundled **Makefile** for most workflows.  Run these from the repository root.

| Command | Description |
|---|---|
| `make install` | Install runtime and test dependencies (`pip install -r requirements.txt` and `tests/requirements-test.txt`). |
| `make test` | Run the full pytest suite (`pytest tests/ -v`). |
| `make test-quick` | Execute only fast tests (`-m "not slow"`). |
| `make test-coverage` | Run tests with coverage and generate HTML report in `tests/coverage/`. |
| `make build` | Build Docker images for the services. |
| `make up` / `make down` | Start or stop the Docker‑Compose test environment (`docker-compose.test.yml`). |
| `make lint` | Run `flake8` and `mypy` on the codebase. |
| `make format` | Auto‑format with **black**. |
| `make ci` | Simulated CI pipeline – critical, AI‑quality, failover and integration tests. |

Typical local workflow: `make install && make test-quick && make up && make check-services`.

## Coding Style & Naming Conventions
* **Formatting** – run `make format` (Black) before committing.
* **Linting** – `make lint` enforces `flake8` (max line length 100) and type‑checking via `mypy`.
* **Indentation** – 4 spaces, no tabs.
* **Names** –
  * Modules & packages: `lower_case` with underscores.
  * Classes: `PascalCase`.
  * Functions & variables: `snake_case`.
  * Constants: `UPPER_SNAKE_CASE`.
* **Imports** – grouped in standard, third‑party, local sections, one per line.

## Testing Guidelines
* **Framework** – `pytest` with configuration in `tests/pytest.ini`.
* **Markers** – use the predefined markers (`unit`, `integration`, `e2e`, `ai`, `failover`, `critical`, `smoke`, etc.) to categorize tests.
* **Coverage** – aim for ≥ 80 % overall; view the HTML report generated by `make test-coverage`.
* **Running a subset** – e.g. `pytest -m critical` or `pytest tests/test_ai_quality.py`.
* **Naming** – test files must start with `test_` and test functions with `test_`.

## Commit & Pull Request Guidelines
* **Commit messages** – follow Conventional Commits (`type(scope): description`). Common types: `feat`, `fix`, `chore`, `refactor`, `test`, `docs`.
* **PR description** – include a short summary, linked issue (if any), list of changed modules, and any required migration steps.
* **Checks** – CI runs `make ci`; PRs must pass all checks before merge.
* **Squash** – prefer squashing commits to keep a linear history.

## Docker & Deployment (Optional)
* Docker images are built with `make build` and orchestrated via `docker-compose.test.yml`.
* Health checks are available at `http://localhost:<port>/health` for each service (see `make check-services`).

---
These guidelines aim to keep the **ree-ai** codebase consistent, testable, and easy to onboard new contributors.

