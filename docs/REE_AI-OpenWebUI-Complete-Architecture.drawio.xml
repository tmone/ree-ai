<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram id="openwebui-crawl4ai-arch" name="Complete Architecture">
    <mxGraphModel dx="2400" dy="1800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="3000">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- TITLE -->
        <mxCell id="title" value="REAL ESTATE RAG SYSTEM - OPEN WEBUI + LANGCHAIN + CRAWL4AI" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a;" vertex="1" parent="1">
          <mxGeometry x="200" y="40" width="2000" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="subtitle" value="Complete Tech Stack: Open WebUI (UI) + LangChain (RAG) + FastAPI (Services) + OpenSearch (Vector+Search) + Crawl4AI (Data Ingestion)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="200" y="100" width="2000" height="40" as="geometry" />
        </mxCell>
        
        <!-- LAYER 1: USER & BROWSER -->
        <mxCell id="layer1-container" value="LAYER 1: USER INTERFACE (Open WebUI)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1f5fe;strokeColor=#01579b;fontSize=18;fontStyle=1;startSize=45;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="180" width="2200" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="user-icon" value="" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#4CAF50;" vertex="1" parent="layer1-container">
          <mxGeometry x="180" y="80" width="50" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="user-label" value="User" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="layer1-container">
          <mxGeometry x="165" y="170" width="80" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=3;" vertex="1" parent="layer1-container">
          <mxGeometry x="400" y="60" width="1700" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-main" value="OPEN WEBUI PLATFORM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbc02d;strokeColor=#000000;fontColor=#000000;fontStyle=1;fontSize=16;" vertex="1" parent="layer1-container">
          <mxGeometry x="1050" y="80" width="250" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-chat" value="Chat Interface&#xa;(Built-in UI)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="450" y="80" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-auth" value="Auth System&#xa;(Users, Roles)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="450" y="150" width="150" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-history" value="Conversation&#xa;History Manager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="650" y="80" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-docs" value="Document&#xa;Upload" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="650" y="150" width="150" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-stream" value="Streaming&#xa;Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="850" y="80" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="openwebui-models" value="Model&#xa;Switching" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff59d;strokeColor=#f57f17;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="850" y="150" width="150" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="auto-solved" value="âœ… AUTO-SOLVED:&#xa;â€¢ Q1: Context Memory (PostgreSQL)&#xa;â€¢ Q2: conversation_id generation&#xa;â€¢ Q4: History loading" style="text;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=13;fontStyle=1;" vertex="1" parent="layer1-container">
          <mxGeometry x="1360" y="70" width="320" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="docker-note" value="ðŸ³ Docker:&#xa;ghcr.io/open-webui/open-webui:main" style="text;html=1;strokeColor=#01579b;fillColor=#e1f5fe;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=2;" vertex="1" parent="layer1-container">
          <mxGeometry x="1720" y="80" width="300" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-user-openwebui" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#4CAF50;" edge="1" parent="layer1-container" source="user-icon" target="openwebui-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- LAYER 2: PIPELINE (LANGCHAIN) -->
        <mxCell id="layer2-container" value="LAYER 2: ORCHESTRATION - OPEN WEBUI PIPELINE (LangChain)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;fontSize=18;fontStyle=1;startSize=45;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="440" width="2200" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;strokeWidth=2;" vertex="1" parent="layer2-container">
          <mxGeometry x="200" y="70" width="1900" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-main" value="PROPERTY SEARCH PIPELINE&#xa;(Python + LangChain)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer2-container">
          <mxGeometry x="950" y="100" width="300" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-intent" value="Intent&#xa;Classification" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="250" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-route" value="Service&#xa;Routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="450" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-context" value="Context&#xa;Management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="650" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-rag" value="RAG Chain&#xa;(LangChain)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="1330" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-format" value="Response&#xa;Formatting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="1530" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="langchain-components" value="LangChain Components:&#xa;â€¢ Chains (RAG, Retrieval)&#xa;â€¢ Retrievers (OpenSearch)&#xa;â€¢ Prompts Templates&#xa;â€¢ Output Parsers" style="text;html=1;strokeColor=#7b1fa2;fillColor=#f3e5f5;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="250" y="180" width="250" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pipeline-file" value="ðŸ“„ File:&#xa;/app/backend/data/pipelines/&#xa;property_search_pipeline.py" style="text;html=1;strokeColor=#7b1fa2;fillColor=#f3e5f5;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=2;" vertex="1" parent="layer2-container">
          <mxGeometry x="1730" y="100" width="330" height="60" as="geometry" />
        </mxCell>
        
        <!-- LAYER 3: DOMAIN SERVICES -->
        <mxCell id="layer3-container" value="LAYER 3: DOMAIN SERVICES (FastAPI)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#2e7d32;fontSize=18;fontStyle=1;startSize=45;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="760" width="2200" height="320" as="geometry" />
        </mxCell>
        
        <mxCell id="service1-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#2e7d32;" vertex="1" parent="layer3-container">
          <mxGeometry x="100" y="70" width="380" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="service1" value="Query Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="130" y="85" width="320" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="service1-feat" value="â€¢ Decomposition&#xa;â€¢ Entity extraction&#xa;â€¢ Query rewriting" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer3-container">
          <mxGeometry x="130" y="145" width="320" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="service1-tech" value="FastAPI + Pydantic" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#666666;" vertex="1" parent="layer3-container">
          <mxGeometry x="130" y="215" width="320" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="service2-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#2e7d32;" vertex="1" parent="layer3-container">
          <mxGeometry x="530" y="70" width="380" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="service2" value="Search Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="560" y="85" width="320" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="service2-feat" value="â€¢ Hybrid search (Vector + BM25)&#xa;â€¢ Filter application&#xa;â€¢ Result aggregation" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer3-container">
          <mxGeometry x="560" y="145" width="320" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="service2-tech" value="FastAPI + OpenSearch" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#666666;" vertex="1" parent="layer3-container">
          <mxGeometry x="560" y="215" width="320" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="service3-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#2e7d32;" vertex="1" parent="layer3-container">
          <mxGeometry x="960" y="70" width="380" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="service3" value="Reranking Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="990" y="85" width="320" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="service3-feat" value="â€¢ Cross-encoder reranking&#xa;â€¢ Score normalization&#xa;â€¢ Top-K selection" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer3-container">
          <mxGeometry x="990" y="145" width="320" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="service3-tech" value="FastAPI + HuggingFace" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#666666;" vertex="1" parent="layer3-container">
          <mxGeometry x="990" y="215" width="320" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="service4-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#2e7d32;" vertex="1" parent="layer3-container">
          <mxGeometry x="1390" y="70" width="380" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="service4" value="Price Suggestion Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="1420" y="85" width="320" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="service4-feat" value="â€¢ Market price analysis&#xa;â€¢ Similar properties&#xa;â€¢ GPT-4 reasoning" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer3-container">
          <mxGeometry x="1420" y="145" width="320" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="service4-tech" value="FastAPI + OpenAI" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#666666;" vertex="1" parent="layer3-container">
          <mxGeometry x="1420" y="215" width="320" height="30" as="geometry" />
        </mxCell>
        
        <!-- LAYER 4: DATA INGESTION (CRAWL4AI) -->
        <mxCell id="layer4-container" value="LAYER 4: DATA INGESTION - CRAWL4AI (Thay tháº¿ Scrapy)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="1120" width="2200" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;strokeWidth=2;" vertex="1" parent="layer4-container">
          <mxGeometry x="200" y="70" width="1900" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-main" value="CRAWL4AI SERVICE&#xa;(AI-Optimized Crawler)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;strokeColor=#000000;fontColor=#000000;fontStyle=1;fontSize=16;" vertex="1" parent="layer4-container">
          <mxGeometry x="950" y="100" width="300" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-feat1" value="âœ… JavaScript&#xa;Rendering&#xa;(Playwright)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="250" y="100" width="150" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-feat2" value="âœ… Auto-Clean&#xa;HTML&#xa;(Remove ads)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="450" y="100" width="150" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-feat3" value="âœ… LLM-Friendly&#xa;Markdown&#xa;(Ready for RAG)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="650" y="100" width="150" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-feat4" value="âœ… Built-in&#xa;Chunking&#xa;(512 tokens)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="1300" y="100" width="150" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-feat5" value="âœ… Async&#xa;Performance&#xa;(47% faster)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="1500" y="100" width="150" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-sources" value="Data Sources:&#xa;â€¢ nhatot.vn&#xa;â€¢ batdongsan.vn&#xa;â€¢ alonhadat.com.vn" style="text;html=1;strokeColor=#e65100;fillColor=#fff3e0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=13;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="1730" y="100" width="320" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-install" value="ðŸ“¦ Install:&#xa;pip install crawl4ai&#xa;playwright install chromium" style="text;html=1;strokeColor=#e65100;fillColor=#fff3e0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=2;" vertex="1" parent="layer4-container">
          <mxGeometry x="250" y="180" width="400" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="crawl4ai-benefit" value="ðŸ’¡ Benefits:&#xa;â€¢ 73% less code vs Scrapy&#xa;â€¢ 47% faster crawling&#xa;â€¢ Zero HTML cleaning code needed" style="text;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=1;" vertex="1" parent="layer4-container">
          <mxGeometry x="700" y="180" width="550" height="50" as="geometry" />
        </mxCell>
        
        <!-- LAYER 5: STORAGE & DATABASES -->
        <mxCell id="layer5-container" value="LAYER 5: STORAGE LAYER" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;fontSize=18;fontStyle=1;startSize=45;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="1440" width="2200" height="320" as="geometry" />
        </mxCell>
        
        <mxCell id="opensearch-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer5-container">
          <mxGeometry x="150" y="70" width="500" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="opensearch" value="OPENSEARCH" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer5-container">
          <mxGeometry x="220" y="90" width="360" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="opensearch-feat" value="â€¢ Vector search (embeddings)&#xa;â€¢ BM25 keyword search&#xa;â€¢ Structured filters&#xa;â€¢ Property listings index&#xa;â€¢ Reference data index" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer5-container">
          <mxGeometry x="220" y="160" width="360" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="postgres-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer5-container">
          <mxGeometry x="720" y="70" width="450" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="postgres" value="POSTGRESQL" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer5-container">
          <mxGeometry x="770" y="90" width="350" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="postgres-feat" value="â€¢ Users & authentication&#xa;â€¢ Conversations history&#xa;â€¢ Feedback & ratings&#xa;â€¢ Property metadata&#xa;(Managed by Open WebUI)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer5-container">
          <mxGeometry x="770" y="160" width="350" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="redis-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer5-container">
          <mxGeometry x="1240" y="70" width="450" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="redis" value="REDIS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer5-container">
          <mxGeometry x="1290" y="90" width="350" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="redis-feat" value="â€¢ Response caching&#xa;â€¢ Session management&#xa;â€¢ Rate limiting&#xa;â€¢ Celery task queue&#xa;(for scheduled crawling)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer5-container">
          <mxGeometry x="1290" y="160" width="350" height="100" as="geometry" />
        </mxCell>
        
        <!-- LAYER 6: EXTERNAL APIS -->
        <mxCell id="layer6-container" value="LAYER 6: EXTERNAL APIS" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3f51b5;fontSize=18;fontStyle=1;startSize=45;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="1800" width="2200" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="openai-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c5cae9;strokeColor=#3f51b5;" vertex="1" parent="layer6-container">
          <mxGeometry x="300" y="70" width="700" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="openai" value="OPENAI API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3f51b5;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer6-container">
          <mxGeometry x="450" y="90" width="400" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="openai-models" value="Models:&#xa;â€¢ GPT-4 mini (chat, reasoning)&#xa;â€¢ text-embedding-3-small (embeddings)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer6-container">
          <mxGeometry x="350" y="150" width="600" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="gateway-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcdd2;strokeColor=#c62828;strokeWidth=3;" vertex="1" parent="layer6-container">
          <mxGeometry x="1100" y="70" width="700" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="gateway" value="OPENAI GATEWAY âš ï¸" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer6-container">
          <mxGeometry x="1200" y="90" width="500" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="gateway-feat" value="Q3 - MUST BUILD:&#xa;â€¢ Rate limiting â€¢ Cost tracking â€¢ Caching â€¢ Monitoring" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;" vertex="1" parent="layer6-container">
          <mxGeometry x="1150" y="150" width="600" height="50" as="geometry" />
        </mxCell>
        
        <!-- DATA FLOW CONNECTIONS -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#1976d2;dashed=1;" edge="1" parent="1" source="openwebui-box" target="pipeline-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#7b1fa2;dashed=1;" edge="1" parent="1" source="pipeline-box" target="service1-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#2e7d32;dashed=1;" edge="1" parent="1" source="service2-box" target="opensearch-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="1300" />
              <mxPoint x="500" y="1300" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#e65100;dashed=1;" edge="1" parent="1" source="crawl4ai-box" target="opensearch-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1200" y="1380" />
              <mxPoint x="500" y="1380" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#3f51b5;dashed=1;" edge="1" parent="1" source="pipeline-box" target="openai-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1200" y="650" />
              <mxPoint x="2000" y="650" />
              <mxPoint x="2000" y="1920" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- LEGEND -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="2100" width="2200" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-title" value="ðŸ“Œ TECH STACK SUMMARY" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="900" y="2120" width="600" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="stack1" value="UI: Open WebUI (Docker)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="2170" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack2" value="Orchestration: LangChain + Python" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="2205" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack3" value="Services: FastAPI + Pydantic" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="2240" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack4" value="Data Ingestion: Crawl4AI + Playwright" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="2170" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack5" value="Vector DB: OpenSearch (hybrid search)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="2205" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack6" value="SQL DB: PostgreSQL (conversations)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="2240" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack7" value="Cache: Redis (sessions, rate limit)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1300" y="2170" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack8" value="LLM: OpenAI GPT-4 mini" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1300" y="2205" width="450" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="stack9" value="Embeddings: text-embedding-3-small" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1300" y="2240" width="450" height="30" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
