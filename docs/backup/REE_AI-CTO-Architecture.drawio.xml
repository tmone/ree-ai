<mxfile host="app.diagrams.net" modified="2025-10-29T08:00:00.000Z" agent="Claude Code" version="24.0.0">
  <diagram id="cto-architecture" name="CTO Architecture - Platform Solutions">
    <mxGraphModel dx="2000" dy="1500" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2200" pageHeight="2800">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="REE AI - PLATFORM THEO SÆ  Äá»’ CTO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=32;fontStyle=1;fontColor=#1a1a1a;" vertex="1" parent="1">
          <mxGeometry x="200" y="40" width="1800" height="60" as="geometry" />
        </mxCell>

        <mxCell id="subtitle" value="10 Services + Model Routing (Ollama/OpenAI) + TRáº¢ Lá»œI 4 CÃ‚U Há»ŽI CTO (Q1, Q2, Q3, Q4)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="200" y="100" width="1800" height="40" as="geometry" />
        </mxCell>

        <!-- USER -->
        <mxCell id="user-icon" value="" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#4CAF50;" vertex="1" parent="1">
          <mxGeometry x="1075" y="180" width="50" height="100" as="geometry" />
        </mxCell>

        <mxCell id="user-label" value="USER&#xa;(Web/Mobile/API)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1050" y="290" width="100" height="40" as="geometry" />
        </mxCell>

        <!-- LAYER 1: User Account Service -->
        <mxCell id="layer1-container" value="USER ACCOUNT SERVICE" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e1f5fe;strokeColor=#01579b;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="360" width="2000" height="180" as="geometry" />
        </mxCell>

        <mxCell id="user-service-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b3e5fc;strokeColor=#01579b;strokeWidth=2;" vertex="1" parent="layer1-container">
          <mxGeometry x="150" y="60" width="1700" height="100" as="geometry" />
        </mxCell>

        <mxCell id="user-service-main" value="USER ACCOUNT SERVICE&#xa;(FastAPI + PostgreSQL + JWT)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0288d1;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer1-container">
          <mxGeometry x="750" y="75" width="500" height="70" as="geometry" />
        </mxCell>

        <mxCell id="user-feat-1" value="â€¢ Register/Login&#xa;â€¢ JWT Token&#xa;â€¢ User Profiles" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="200" y="80" width="150" height="60" as="geometry" />
        </mxCell>

        <mxCell id="user-feat-2" value="â€¢ Roles &amp; Permissions&#xa;â€¢ Password hashing&#xa;â€¢ Session management" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer1-container">
          <mxGeometry x="400" y="80" width="200" height="60" as="geometry" />
        </mxCell>

        <mxCell id="user-platform" value="Platform: FastAPI (72Kâ­) + PostgreSQL + JWT" style="text;html=1;align=right;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#01579b;" vertex="1" parent="layer1-container">
          <mxGeometry x="1350" y="85" width="450" height="30" as="geometry" />
        </mxCell>

        <!-- LAYER 2: Orchestrator -->
        <mxCell id="layer2-container" value="ORCHESTRATOR (Message Routing)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="580" width="2000" height="220" as="geometry" />
        </mxCell>

        <mxCell id="orch-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe0b2;strokeColor=#e65100;strokeWidth=2;" vertex="1" parent="layer2-container">
          <mxGeometry x="150" y="60" width="1700" height="140" as="geometry" />
        </mxCell>

        <mxCell id="orch-main" value="ORCHESTRATOR&#xa;(FastAPI + gRPC)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;strokeColor=#000000;fontColor=#000000;fontStyle=1;fontSize=16;" vertex="1" parent="layer2-container">
          <mxGeometry x="750" y="80" width="500" height="70" as="geometry" />
        </mxCell>

        <mxCell id="orch-route-1" value="Route: create RE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="200" y="90" width="150" height="50" as="geometry" />
        </mxCell>

        <mxCell id="orch-route-2" value="Route: search RE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="400" y="90" width="150" height="50" as="geometry" />
        </mxCell>

        <mxCell id="orch-route-3" value="Route: price" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc80;strokeColor=#e65100;fontSize=12;" vertex="1" parent="layer2-container">
          <mxGeometry x="600" y="90" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="orch-q2" value="Q2 ANSWER: Gen conversation_id (UUID)" style="text;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=13;fontStyle=1;" vertex="1" parent="layer2-container">
          <mxGeometry x="1300" y="80" width="500" height="40" as="geometry" />
        </mxCell>

        <mxCell id="orch-platform" value="Platform: FastAPI (72Kâ­) + gRPC" style="text;html=1;align=right;verticalAlign=middle;fontSize=11;fontStyle=2;fontColor=#e65100;" vertex="1" parent="layer2-container">
          <mxGeometry x="1300" y="130" width="500" height="30" as="geometry" />
        </mxCell>

        <!-- LAYER 3: 10 Services -->
        <mxCell id="layer3-container" value="10 SERVICES LAYER (Microservices - FastAPI)" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="840" width="2000" height="680" as="geometry" />
        </mxCell>

        <!-- Row 1: Services 1-3 -->
        <mxCell id="service1-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="50" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="service1" value="1ï¸âƒ£ SEMANTIC CHUNKING&#xa;(Sentence-Transformers)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="80" y="85" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service1-feat" value="6 Steps CTO:&#xa;1. Segment sentences (NLTK)&#xa;2. Embed each (sentence-transformers)&#xa;3. Cosine similarity&#xa;4. Combine >0.75&#xa;5. Overlap&#xa;6. Final embedding" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="80" y="145" width="540" height="90" as="geometry" />
        </mxCell>

        <mxCell id="service2-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="700" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="service2" value="2ï¸âƒ£ ATTRIBUTE EXTRACTION&#xa;(GPT-4 mini + Pydantic)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="730" y="85" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service2-feat" value="LLM-driven extraction:&#xa;â€¢ Price, Location, Bedrooms&#xa;â€¢ Structured JSON output&#xa;â€¢ Pydantic validation&#xa;&#xa;ðŸŸ¢ Uses: Ollama llama3.1:8b (FREE)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="730" y="145" width="540" height="90" as="geometry" />
        </mxCell>

        <mxCell id="service3-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="1350" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="service3" value="3ï¸âƒ£ CLASSIFICATION SERVICE&#xa;(3 modes)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="1380" y="85" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service3-feat" value="Classify query mode:&#xa;â€¢ filter (structured)&#xa;â€¢ semantic (vector search)&#xa;â€¢ both (hybrid)&#xa;&#xa;ðŸŸ¢ Uses: Ollama llama3.1:8b (FREE)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="1380" y="145" width="540" height="90" as="geometry" />
        </mxCell>

        <!-- Row 2: Services 4-6 -->
        <mxCell id="service4-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="50" y="280" width="600" height="160" as="geometry" />
        </mxCell>

        <mxCell id="service4" value="4ï¸âƒ£ COMPLETENESS FEEDBACK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="80" y="295" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service4-feat" value="Score response 0-100:&#xa;If &lt;70 â†’ re-generate&#xa;&#xa;ðŸ”µ Uses: OpenAI GPT-4 mini ($$)&#xa;Complex reasoning required" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="80" y="355" width="540" height="70" as="geometry" />
        </mxCell>

        <mxCell id="service5-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="700" y="280" width="600" height="160" as="geometry" />
        </mxCell>

        <mxCell id="service5" value="5ï¸âƒ£ PRICE SUGGESTION" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="730" y="295" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service5-feat" value="Market analysis + reasoning:&#xa;â€¢ Similar properties&#xa;â€¢ Price range suggestion&#xa;&#xa;ðŸ”µ Uses: OpenAI GPT-4 mini ($$)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="730" y="355" width="540" height="70" as="geometry" />
        </mxCell>

        <mxCell id="service6-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#7b1fa2;" vertex="1" parent="layer3-container">
          <mxGeometry x="1350" y="280" width="600" height="160" as="geometry" />
        </mxCell>

        <mxCell id="service6" value="6ï¸âƒ£ RERANK SERVICE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=14;" vertex="1" parent="layer3-container">
          <mxGeometry x="1380" y="295" width="540" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service6-feat" value="cross-encoder (HuggingFace):&#xa;â€¢ Re-score search results&#xa;â€¢ Top-K selection&#xa;&#xa;FREE - No LLM needed" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;" vertex="1" parent="layer3-container">
          <mxGeometry x="1380" y="355" width="540" height="70" as="geometry" />
        </mxCell>

        <!-- Row 3: Core Gateway -->
        <mxCell id="service7-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=4;" vertex="1" parent="layer3-container">
          <mxGeometry x="50" y="470" width="1900" height="180" as="geometry" />
        </mxCell>

        <mxCell id="service7" value="7ï¸âƒ£ CORE SERVICE (OpenAI Gateway) - Q3 ANSWER â­" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fbc02d;strokeColor=#000000;fontColor=#000000;fontStyle=1;fontSize=16;" vertex="1" parent="layer3-container">
          <mxGeometry x="600" y="490" width="800" height="60" as="geometry" />
        </mxCell>

        <mxCell id="service7-feat-1" value="LiteLLM + Redis + Ollama:&#xa;â€¢ Rate limiting&#xa;â€¢ Cost tracking&#xa;â€¢ Response caching&#xa;â€¢ Centralized monitoring" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer3-container">
          <mxGeometry x="80" y="560" width="400" height="70" as="geometry" />
        </mxCell>

        <mxCell id="service7-feat-2" value="MODEL ROUTING (NEW):&#xa;â€¢ Ollama llama3.1:8b â†’ simple tasks ($0)&#xa;â€¢ OpenAI GPT-4 mini â†’ complex ($)&#xa;â€¢ Auto fallback&#xa;â€¢ 10% cost savings" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontColor=#f57f17;fontStyle=1;" vertex="1" parent="layer3-container">
          <mxGeometry x="520" y="560" width="450" height="80" as="geometry" />
        </mxCell>

        <mxCell id="service7-q3" value="Q3 ANSWER:&#xa;CÃ“ cáº§n Core Service â†’ CÃ“! (Báº¯t buá»™c)&#xa;Rate limit + Cost track + Model routing" style="text;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=13;fontStyle=1;" vertex="1" parent="layer3-container">
          <mxGeometry x="1020" y="560" width="900" height="70" as="geometry" />
        </mxCell>

        <!-- LAYER 4: Storage -->
        <mxCell id="layer4-container" value="STORAGE LAYER" style="swimlane;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="1560" width="2000" height="280" as="geometry" />
        </mxCell>

        <mxCell id="opensearch-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer4-container">
          <mxGeometry x="50" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="opensearch" value="OPENSEARCH&#xa;(Vector DB + BM25)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer4-container">
          <mxGeometry x="100" y="90" width="500" height="60" as="geometry" />
        </mxCell>

        <mxCell id="opensearch-feat" value="â€¢ Vector search (embeddings)&#xa;â€¢ BM25 keyword search&#xa;â€¢ Hybrid retrieval&#xa;â€¢ Property listings index" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer4-container">
          <mxGeometry x="100" y="160" width="500" height="70" as="geometry" />
        </mxCell>

        <mxCell id="postgres-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer4-container">
          <mxGeometry x="700" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="postgres" value="POSTGRESQL&#xa;(Context Memory)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer4-container">
          <mxGeometry x="750" y="90" width="500" height="60" as="geometry" />
        </mxCell>

        <mxCell id="postgres-feat" value="Q1, Q4 ANSWER:&#xa;â€¢ Users &amp; authentication&#xa;â€¢ Conversations (conversation_id)&#xa;â€¢ Messages (history)&#xa;â€¢ Load history â†’ Inject to prompt" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fillColor=#c8e6c9;strokeColor=#388e3c;" vertex="1" parent="layer4-container">
          <mxGeometry x="750" y="160" width="500" height="70" as="geometry" />
        </mxCell>

        <mxCell id="redis-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#c2185b;" vertex="1" parent="layer4-container">
          <mxGeometry x="1350" y="70" width="600" height="180" as="geometry" />
        </mxCell>

        <mxCell id="redis" value="REDIS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer4-container">
          <mxGeometry x="1400" y="90" width="500" height="60" as="geometry" />
        </mxCell>

        <mxCell id="redis-feat" value="â€¢ Response caching (Core Gateway)&#xa;â€¢ Rate limiting (token bucket)&#xa;â€¢ Celery task queue&#xa;â€¢ Session management" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer4-container">
          <mxGeometry x="1400" y="160" width="500" height="70" as="geometry" />
        </mxCell>

        <!-- LAYER 5: Crawler -->
        <mxCell id="layer5-container" value="DATA INGESTION" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#2e7d32;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="1880" width="2000" height="200" as="geometry" />
        </mxCell>

        <mxCell id="crawler-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#2e7d32;" vertex="1" parent="layer5-container">
          <mxGeometry x="150" y="60" width="1700" height="120" as="geometry" />
        </mxCell>

        <mxCell id="crawler" value="REAL ESTATE CRAWLER&#xa;(Crawl4AI + Playwright)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer5-container">
          <mxGeometry x="700" y="80" width="600" height="70" as="geometry" />
        </mxCell>

        <mxCell id="crawler-feat" value="â€¢ nhatot.vn, batdongsan.vn&#xa;â€¢ JS rendering (Playwright)&#xa;â€¢ LLM-friendly markdown&#xa;â€¢ Celery Beat (every 6h)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer5-container">
          <mxGeometry x="200" y="90" width="400" height="70" as="geometry" />
        </mxCell>

        <mxCell id="crawler-benefit" value="vs Scrapy:&#xa;â€¢ 73% less code&#xa;â€¢ 47% faster&#xa;â€¢ Auto clean HTML" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fillColor=#fff3e0;strokeColor=#e65100;" vertex="1" parent="layer5-container">
          <mxGeometry x="1400" y="90" width="400" height="70" as="geometry" />
        </mxCell>

        <!-- LAYER 6: External -->
        <mxCell id="layer6-container" value="EXTERNAL LLM PROVIDERS" style="swimlane;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3f51b5;fontSize=18;fontStyle=1;startSize=45;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="2120" width="2000" height="220" as="geometry" />
        </mxCell>

        <mxCell id="ollama-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c5cae9;strokeColor=#3f51b5;" vertex="1" parent="layer6-container">
          <mxGeometry x="100" y="70" width="850" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ollama" value="OLLAMA (Self-hosted)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3f51b5;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer6-container">
          <mxGeometry x="200" y="90" width="650" height="50" as="geometry" />
        </mxCell>

        <mxCell id="ollama-models" value="Models: llama3.1:8b, llama3.1:70b&#xa;FREE - Self-hosted&#xa;Use: Simple tasks (Attribute Extraction, Classification)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer6-container">
          <mxGeometry x="150" y="150" width="750" height="30" as="geometry" />
        </mxCell>

        <mxCell id="openai-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c5cae9;strokeColor=#3f51b5;" vertex="1" parent="layer6-container">
          <mxGeometry x="1050" y="70" width="850" height="120" as="geometry" />
        </mxCell>

        <mxCell id="openai" value="OPENAI API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3f51b5;strokeColor=#000000;fontColor=#ffffff;fontStyle=1;fontSize=16;" vertex="1" parent="layer6-container">
          <mxGeometry x="1150" y="90" width="650" height="50" as="geometry" />
        </mxCell>

        <mxCell id="openai-models" value="Models: GPT-4 mini, text-embedding-3-small&#xa;Cost: $0.15/$0.60 per 1M tokens&#xa;Use: Complex tasks (Completeness, Price Suggestion)" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="layer6-container">
          <mxGeometry x="1100" y="150" width="750" height="30" as="geometry" />
        </mxCell>

        <!-- Data Flow Arrows -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;strokeColor=#1976d2;dashed=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="user-icon" target="layer1-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;strokeColor=#e65100;dashed=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="layer1-container" target="layer2-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;strokeColor=#7b1fa2;dashed=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="layer2-container" target="layer3-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;strokeColor=#c2185b;dashed=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="layer3-container" target="layer4-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;strokeColor=#2e7d32;dashed=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="layer5-container" target="layer4-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#3f51b5;dashed=1;" edge="1" parent="1" source="layer3-container" target="layer6-container">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2150" y="1180" />
              <mxPoint x="2150" y="2230" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="2380" width="2000" height="280" as="geometry" />
        </mxCell>

        <mxCell id="legend-title" value="SUMMARY - TRáº¢ Lá»œI 4 CÃ‚U Há»ŽI CTO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="2400" width="1000" height="40" as="geometry" />
        </mxCell>

        <mxCell id="q1-answer" value="Q1: Context Memory?&#xa;â†’ PostgreSQL + conversation_id (NOT OpenAI)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fillColor=#c8e6c9;strokeColor=#388e3c;" vertex="1" parent="1">
          <mxGeometry x="150" y="2460" width="900" height="40" as="geometry" />
        </mxCell>

        <mxCell id="q2-answer" value="Q2: User mapping?&#xa;â†’ Orchestrator gen UUID conversation_id" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fillColor=#c8e6c9;strokeColor=#388e3c;" vertex="1" parent="1">
          <mxGeometry x="1150" y="2460" width="900" height="40" as="geometry" />
        </mxCell>

        <mxCell id="q3-answer" value="Q3: Core Service needed?&#xa;â†’ YES! LiteLLM + Redis + Ollama (rate limit, cost track, model routing)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fillColor=#c8e6c9;strokeColor=#388e3c;" vertex="1" parent="1">
          <mxGeometry x="150" y="2520" width="900" height="40" as="geometry" />
        </mxCell>

        <mxCell id="q4-answer" value="Q4: Conversation history?&#xa;â†’ Load PostgreSQL messages â†’ Inject to prompt" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fillColor=#c8e6c9;strokeColor=#388e3c;" vertex="1" parent="1">
          <mxGeometry x="1150" y="2520" width="900" height="40" as="geometry" />
        </mxCell>

        <mxCell id="platforms" value="ALL PLATFORMS FREE: FastAPI (72Kâ­), Sentence-Transformers (13Kâ­), LiteLLM (10Kâ­), Ollama, Crawl4AI (4Kâ­), OpenSearch (8.5Kâ­), PostgreSQL, Redis" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="150" y="2580" width="1900" height="30" as="geometry" />
        </mxCell>

        <mxCell id="cost" value="COST: $0 tools + $100-300/month OpenAI API (10% savings with Ollama routing)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=13;fontStyle=1;fillColor=#fff3e0;strokeColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="150" y="2620" width="1900" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
