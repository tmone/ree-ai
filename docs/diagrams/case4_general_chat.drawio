<mxfile host="app.diagrams.net">
  <diagram name="Case 4: General Chat" id="case4">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Case 4: General Chat (CHAT)" style="text;fontSize=18;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="40" width="600" height="30" as="geometry" />
        </mxCell>

        <!-- Entry -->
        <mxCell id="user" value="USER" style="shape=actor;fillColor=#90EE90;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="140" width="40" height="60" as="geometry" />
        </mxCell>

        <mxCell id="webui" value="Open WebUI" style="rounded=1;fillColor=#90EE90;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="180" y="150" width="120" height="40" as="geometry" />
        </mxCell>

        <!-- Orchestrator -->
        <mxCell id="orch" value="Orchestrator" style="rounded=1;fillColor=#FFD700;strokeColor=#333333;strokeWidth=3;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="360" y="140" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Services -->
        <mxCell id="service_label" value="Layer 3 and 5 Services" style="text;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="100" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="classification" value="Classification Service&#xa;:8083" style="rounded=1;fillColor=#FFEB99;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="700" y="140" width="180" height="50" as="geometry" />
        </mxCell>

        <mxCell id="coregw" value="Core Gateway&#xa;:8080 LiteLLM" style="rounded=1;fillColor=#FFB366;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="700" y="340" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="llm" value="GPT-4o / GPT-4o-mini" style="shape=cylinder;fillColor=#B0E0B0;strokeColor=#333333;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="950" y="340" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="postgres" value="PostgreSQL&#xa;History" style="shape=cylinder;fillColor=#B0E0B0;strokeColor=#333333;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="450" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Internal Steps -->
        <mxCell id="decision" value="Has Files?" style="rhombus;fillColor=#FFE6CC;strokeColor=#D79B00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="370" y="270" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="step1a" value="Multimodal:&#xa;Vision GPT-4o" style="rounded=1;fillColor=#E8F4F8;strokeColor=#4A90E2;strokeWidth=2;dashed=1;dashPattern=3 3;" vertex="1" parent="1">
          <mxGeometry x="200" y="410" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="step1b" value="Text-only:&#xa;GPT-4o-mini" style="rounded=1;fillColor=#E8F4F8;strokeColor=#4A90E2;strokeWidth=2;dashed=1;dashPattern=3 3;" vertex="1" parent="1">
          <mxGeometry x="520" y="410" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="step2" value="Build Messages&#xa;with History" style="rounded=1;fillColor=#E8F4F8;strokeColor=#4A90E2;strokeWidth=2;dashed=1;dashPattern=3 3;" vertex="1" parent="1">
          <mxGeometry x="350" y="530" width="160" height="60" as="geometry" />
        </mxCell>

        <mxCell id="step3" value="Generate Response" style="rounded=1;fillColor=#E8F4F8;strokeColor=#4A90E2;strokeWidth=2;dashed=1;dashPattern=3 3;" vertex="1" parent="1">
          <mxGeometry x="350" y="630" width="160" height="60" as="geometry" />
        </mxCell>

        <mxCell id="response" value="Response:&#xa;Chat answer" style="rounded=1;fillColor=#90EE90;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="350" y="730" width="160" height="50" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <mxCell id="e1" value="" edge="1" parent="1" source="user" target="webui">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e2" value="" edge="1" parent="1" source="webui" target="orch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e3" value="1. Classify" edge="1" parent="1" source="orch" target="classification" style="strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e4" value="2. LLM Call" edge="1" parent="1" source="step2" target="coregw" style="strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e5" value="" edge="1" parent="1" source="coregw" target="llm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e6" value="3. Save History" edge="1" parent="1" source="response" target="postgres" style="strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e7" value="Check files" edge="1" parent="1" source="orch" target="decision" style="dashed=1;dashPattern=3 3;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e8" value="YES" edge="1" parent="1" source="decision" target="step1a" style="dashed=1;dashPattern=3 3;strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e9" value="NO" edge="1" parent="1" source="decision" target="step1b" style="dashed=1;dashPattern=3 3;strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e10" value="" edge="1" parent="1" source="step1a" target="step2" style="dashed=1;dashPattern=3 3;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e11" value="" edge="1" parent="1" source="step1b" target="step2" style="dashed=1;dashPattern=3 3;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e12" value="context" edge="1" parent="1" source="step2" target="step3" style="dashed=1;dashPattern=3 3;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e13" value="" edge="1" parent="1" source="step3" target="response" style="dashed=1;dashPattern=3 3;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="e14" value="" edge="1" parent="1" source="response" target="webui" style="strokeWidth=2;edgeStyle=orthogonalEdgeStyle;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="755" />
              <mxPoint x="240" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Examples -->
        <mxCell id="example1" value="Text Example:&#xa;User: Xin chao&#xa;Response: Xin chao! Toi co the giup gi?" style="rounded=0;fillColor=#E1F5E1;strokeColor=#4CAF50;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="60" y="550" width="260" height="80" as="geometry" />
        </mxCell>

        <mxCell id="example2" value="Multimodal Example:&#xa;User: Danh gia can ho + image&#xa;Response: Can ho cao cap...&#xa;vision analysis" style="rounded=0;fillColor=#E1F5E1;strokeColor=#4CAF50;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="60" y="650" width="260" height="90" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="Legend:&#xa;Solid: Service call&#xa;Dashed: Internal step&#xa;Decision: Has files?" style="rounded=0;fillColor=#FFF;strokeColor=#333;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="950" y="200" width="180" height="90" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
